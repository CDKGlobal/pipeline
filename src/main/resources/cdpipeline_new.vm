<!-- main page of the CDPipeline plugin which displays relevant information on builds-->
<!DOCTYPE html>

	<head>
		<title>CDPipeline Wallboard</title> <!-- update once we have an agreed name -->
		<meta name="decorator" content="atl.general">
		<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
		
		${webResourceManager.requireResource("com.cobalt.cdpipeline.cdpipeline:cdpipeline-resources")}
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
		${webResourceManager.requireResource("com.atlassian.auiplugin:aui-experimental-progress-tracker")}
		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.19/angular.js"></script>
	</head>


	<body>
	<div ng-app="CDPipeline">
	
		<!-- main page shell -->
		<div ng-controller="MainController">
			<div class="alert alert-info alert-dismissible" role="alert">
 				<button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
 				<strong>Hey!</strong> This is CDPipeline v2 but with AngularJS now cool
			</div>
		</div>

		<!-- sidebar section for expanded info -->
		<!-- <div id="side" ng-controller="SideController">

		</div> -->

		<!-- board section to display all plan's initial info -->
         <div id="board" class="container-fluid" ng-controller="BoardController" ng-style="{height: ((results.resp.length * 180) + 'px')}">
            <div class="animate-repeat" ng-repeat="result in results.resp | orderBy:'lastUpdateTime':true track by result.planKey"
                                        ng-style="{top: (($index * 180) + 'px')}">
				<div class="panel panel-default">
					<div class="panel-body">

					<!-- TEMPORARY PLACEMENT OF "strips.html" template for testing purposes -->

						<!-- left column -->
						<div class="col-md-2">
							<div>
								<project>{{ result.projectName }}</project>
							</div>
							<div>
								<plan>{{ result.planName }}</plan>
							</div>
						</div>
						
						<div class="col-md-2">
							<span class="aui-lozenge aui-lozenge-complete">Last Deployment</span><br>
							<div>
								<days ng-switch="result.daysSinceDeploymentFromCurrent">
									<span ng-switch-when="-1">--</span>
									<span ng-switch-default>{{ result.daysSinceDeploymentFromCurrent }}</span>
								</days>days ago 
								<changes>{{ result.numChanges }}</changes> changes
							</div>
						</div>

						<!-- right column -->
						<div class="col-md-1">		
							<!--place AUI icon here, get logic in directive -->
							<div id="buildNumber" class="col-md-1">
								<a href="../../browse/{{result.currentBuild.buildKey}}/latest">
									#{{ result.currentBuild.buildNumber }}
								</a>
							</div>
						</div>
							

						<div class="col-md-7">	
							<!-- contributors -->
							<div>
								<span ng-repeat="contributor in result.contributorsSortedByLatestCommit" class="aui-avatar aui-avatar-medium CDcontributor" tooltip="{{ contributor.fullname }}">
									<contributor username="{{ contributor.username }}" numCommits=" {{contributor.numCommits }}">
										<a href="{{ contributor.profilePageUrl }}">
											<span class="aui-avatar-inner">
												<img alt="{{ contributor.fullname }}" src="{{ contributor.pictureUrl }}" />
											</span>
										</a>
									</contributor>
								</span>
							</div>
					
							<div>
								<ol class="pipelineTracker" data-pipelineTracker-steps="{{ result.pipelineStages.size }}">
	
									<!-- show all stages of pipeline -->		
									<li ng-repeat="pipe in result.pipelineStages" ng-class="{true: '{{pipe.cdpipelineState}}', false: '{{pipe.cdpipelineState}} stageLine' } [{{$last}}]" style="width:{{1/result.pipelineStages.length * 100 | number: 0}}%">
										<div>
											<div class="stageCircle {{pipe.cdpipelineState}}"></div>
											<strong>{{ pipe.stageName }}</strong>
										</div>
									</li>
								</ol>
							</div>
						</div>	


					<!-- END TEMPLATE -->

					</div>
				</div>
			</div>
		</div>
	</body>

</html>