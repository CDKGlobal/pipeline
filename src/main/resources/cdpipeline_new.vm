<!-- main page of the CDPipeline plugin which displays relevant information on builds-->
<!DOCTYPE html>

	<head>
		<title>CDPipeline Wallboard</title> <!-- update once we have an agreed name -->
		<meta name="decorator" content="atl.general">
		<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
		${webResourceManager.requireResource("com.cobalt.cdpipeline.cdpipeline:cdpipeline-resources")}
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
		${webResourceManager.requireResource("com.atlassian.auiplugin:aui-experimental-progress-tracker")}
		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.19/angular.js"></script>
	</head>


	<body>
	<div ng-app="CDPipeline">
	
		<!-- main page shell -->
		<div ng-controller="MainController">
			<div class="alert alert-info alert-dismissible" role="alert">
 				<button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
 				<strong>Hey!</strong> This is CDPipeline v2 but with AngularJS now cool
			</div>
		</div>

		<!-- sidebar section for expanded info -->
		<!-- <div id="side" ng-controller="SideController">

		</div> -->

		<!-- board section to display all plan's initial info -->
		<div id="board" class="container-fluid" ng-controller="BoardController">
			<div class="row" ng-repeat="result in results.resp">
				<div class="panel panel-default">
					<div class="panel-body">

					<!-- TEMPORARY PLACEMENT OF "strips.html" template for testing purposes -->

						<!-- left column -->
						<div class="col-md-4">
							<div>
								<project>{{ result.projectName }}</project>
							</div>

							<div>
								<strong><plan>{{ result.planName }}</plan></strong>
							</div>

							<div>
								<strong><days>{{ result.daysSinceDeploymentFromCurrent }}</days></strong> DAYS 
								<strong><changes>{{ result.numChanges }}</changes></strong> CHANGES
							</div>
						</div>

						<!-- right column -->
						<div class="col-md-8" id="leftContainer">
							<div class="row">
								<!--place AUI icon here, get logic in directive -->
								<div id="buildNumber" class="col-md-1">
									<strong><build>#{{ result.currentBuild.buildNumber }}</build></strong>
								</div>

								<div id="pipelineContributor" class="col-md-10">
								
									<div>
										<ol class="aui-progress-tracker" >

											<!-- show all stages of pipeline -->		
									    	<li ng-repeat="pipe in result.pipelineStages" ng-class="{true: 'aui-progress-tracker-step', false: 'aui-progress-tracker-step aui-progress-tracker-step-current'}[{{pipe.state == 'SUCCESS'}}]" style="width:{{1/result.pipelineStages.length * 100 | number: 0}}%" >
										  		<span><stageBuild>{{ pipe.stageName }}</stageBuild><state>{{pipe.state}}</state></span>
										  	</li>
										</ol>
									</div>

									<div>
										<!-- show all contributors pictures -->
										<span ng-repeat="contributor in result.contributorsSortedByLatestCommit" popover="{{ contributor.fullname }}" popover-trigger="mouseenter">
											<contributor username="{{ contributor.username }}" numCommits=" {{contributor.numCommits }}">
												<a href="{{ contributor.profilePageUrl }}">
													<span class="aui-avatar aui-avatar-project aui-avatar-large">
														<span class="aui-avatar-inner">
															<img alt="{{ contributor.fullname }}" src="{{ contributor.pictureUrl }}"/>
														</span>
													</span>
												</a>
											</contributor>
										</span>
									</div>
								</div>
							</div>
						</div>

					<!-- END TEMPLATE -->

					</div>
				</div>
			</div>
		</div>
	</body>

</html>